<?xml version="1.0" encoding="UTF-8"?>
<pegarules>
	<!-- This is a minimum format prconfig.xml file.  Only the settings which are required to access settings in the database are included.
	All other settings which were formerly located only in this file are now Data-Admin-System-Settings.      -->
	<env name="initialization/settingsource" value="merged" />
	<env name="database/databases/PegaRULES/dataSource" value="java:comp/env/jdbc/PegaRULES"/>
	<env name="database/databases/PegaDATA/dataSource" value="java:comp/env/jdbc/PegaRULES"/>

	{{ if .Env.PEGA_SEARCH_URL }}
	<env name="database/databases/pegasearch/searchEndpoint" value="{{ .Env.PEGA_SEARCH_URL }}"/>
	{{ end }}

	<!-- Todo: Below env needs to be further tested for JBoss -->

	{{ if .Env.PEGA_SEARCH_TYPE }}
	<env name="database/databases/pegasearch/searchDeploymentType" value="{{ .Env.PEGA_SEARCH_TYPE }}"/>
	{{ end }}

	{{ if .Env.PEGA_STREAM_URL }}
	<env name="services/stream/validate" value="true"/>
	<env name="services/stream/provider" value="StreamService"/>
	<env name="services/stream/provider_url" value="{{ .Env.PEGA_STREAM_URL }}"/>
	{{ end }}

	{{ if isTrue .Env.CASSANDRA_CLUSTER }}
	<env name="dnode/external_cassandra_cluster" value="{{ .Env.CASSANDRA_CLUSTER }}"/>
	<env name="dnode/external_cassandra_nodes" value="{{ default .Env.CASSANDRA_NODES "" }}"/>
	<env name="dnode/external_cassandra_port" value="{{ default .Env.CASSANDRA_PORT "9042" }}"/>
	<env name="dnode/cassandra_username" value="{{ default .Env.SECRET_CASSANDRA_USERNAME "dnode_ext" }}"/>
	<env name="dnode/cassandra_password" value="{{ default .Env.SECRET_CASSANDRA_PASSWORD "dnode_ext" }}"/>
	{{ end }}

	{{ if isTrue .Env.CASSANDRA_CLIENT_ENCRYPTION}}
	<env name="dnode/cassandra_client_encryption/enabled" value="{{ .Env.CASSANDRA_CLIENT_ENCRYPTION }}"/>
	{{ if .Env.CASSANDRA_TRUSTSTORE -}}
	<env name="dnode/cassandra_client_encryption/truststore" value="{{ .Env.CASSANDRA_TRUSTSTORE }}"/>
	<env name="dnode/cassandra_client_encryption/truststore_password" value="{{ .Env.SECRET_CASSANDRA_TRUSTSTORE_PASSWORD }}"/>
	{{- end }}
	{{ if .Env.CASSANDRA_KEYSTORE -}}
	<env name="dnode/cassandra_client_encryption/keystore" value="{{ .Env.CASSANDRA_KEYSTORE }}"/>
	<env name="dnode/cassandra_client_encryption/keystore_password" value="{{.Env.SECRET_CASSANDRA_KEYSTORE_PASSWORD }}"/>
	{{- end }}
	{{ end }}

	<env name="session/ha/quiesce/strategy/shutdownquiesce" value="true"/>
	<env name="session/ha/enabled" value="true"/>
	<env name="dsm/services/stream/pyBaseLogPath" value="/opt/pega/kafkadata/data"/>
	<env name="cloud/isNodeAgnosticAdminStudio" value="true"/>

	{{ if isTrue .Env.HZ_CLIENT_MODE }}
	<env name="cluster/clientserver/clientmode" value="{{ .Env.HZ_CLIENT_MODE }}"/>
	<env name="cluster/clientserver/hzOnK8s" value="{{ .Env.HZ_DISCOVERY_K8S }}"/>
	<env name="identification/cluster/name" value="{{ .Env.HZ_CLUSTER_NAME }}"/>
	<env name="cluster/clientserver/server/hostname" value="{{ .Env.HZ_SERVER_HOSTNAME }}"/>
	<env name="cluster/clientserver/authentication/username" value="{{ .Env.SECRET_HZ_CS_AUTH_USERNAME }}"/>
	<env name="cluster/clientserver/authentication/password" value="{{ .Env.SECRET_HZ_CS_AUTH_PASSWORD }}"/>
	{{ end }}

	<!-- The below setting is deprecated.
	A new concept of node classification has been introduced which can be enabled by setting the nodetype via JVM argument, e.g. -DNodeType=BackgroundProcessing -->
	<!--env name="initialization/nodeclassification" value="Agent" /  -->
	 
	<!-- Settings can still be put in this file.  If they are, then the value in this file will override the value in the database
	for this node.  This is useful for settings which are specific to this node and should not be shared by multiple nodes on this
	system. -->
	
	<!--
	Pegasystems recommends that you use Application Server connection pooling to the database for Websphere and 
		Weblogic.  These examples are provided if you need to use Pega Connection Pooling for Tomcat or for testing purposes.
		If you are using Application server connection pooling, there is no longer a need to edit this file.  
		
		****The new format for this file is only valid if you are using Application Server connection pooling. If you are not, please replace
		this file with an older version. ***
		
	
	Oracle 10g (Type 4) oracle.jdbc.OracleDriver                jdbc:oracle:thin:@serverName:1521:db  
	IBM DB/2 Type 4     com.ibm.db2.jcc.DB2Driver               jdbc:db2://serverName:port/dbName
	SQL Server 2005     com.microsoft.sqlserver.jdbc.SQLServerDriver jdbc:sqlserver://serverName:1433;SelectMethod=cursor;SendStringParametersAsUnicode=false
	-->
	
	<!--
	<env name="database/drivers" value="com.microsoft.sqlserver.jdbc.SQLServerDriver;oracle.jdbc.OracleDriver" />
	<env name="database/databases/PegaRULES/url" value="jdbc:sqlserver://serverName:1433;SelectMethod=cursor;SendStringParametersAsUnicode=false" />
	<env name="database/databases/PegaRULES/userName" value="a_username" />
	<env name="database/databases/PegaRULES/password" value="a_password" />
	
	<env name="database/databases/PegaDATA/url" value="jdbc:sqlserver://serverName:1433;SelectMethod=cursor;SendStringParametersAsUnicode=false" />
	<env name="database/databases/PegaDATA/userName" value="a_username" />
	<env name="database/databases/PegaDATA/password" value="a_password" />
	-->
</pegarules>
